# downloader_first_java
simple multithread html downloader (demo)
#["Консольная утилита для скачивания файлов по HTTP протоколу."](https://github.com/Ecwid/new-job/blob/master/Console-downloader.md)

по мотивам [этой статьи](https://habrahabr.ru/company/ecwid/blog/315228/)

Сделано:

1. Пакетная Закачка файлов по html 
2. Многопоточность загрузки задаваемая пользователем
3. Лимитирование скорости
3. Ключи -f -o -n -l с перфиксами k M
5. Копирование уже скаченных файлов (одинаковых ссылок)
4. Вывод статистики 

сделан в среде intellij idea 2016.3
c build.gradle

при работе если параметры не заданы или с ошибками то выводит хелп
если параметры нормальные то:

1. выводит все настройки
2. строку что список ссылок с файлами загружен и проверен на корректность и перечень сбойных строк
3. начинает закачку
4. во время закачки показывает N столбцов с трафиком у каждого потока и N+1 столбец - скорость в байтах в сек
5. после показывает статистику

проверил что:
* работает с 1..32684 потоками
* с скоростью от 1кбайт в сек до INT_MAX
* без декодирования html ссылок как и сказано в ТЗ (без decode)
* для удобства имя файла может быть выровнено пробелами

Проверял на своём серваке apache, проверил на скорости от 1к до 100мегабит 

Алгоритм лимитирования скорости - модифицированный backet 

1. Поток-арбитр увеличивает атомарный счётчик байт, но до потолка - до заданной скорости
2. другие потоки этот атомарный счётчик  или уменьшают или если меньше запрошенного кол-ва то ждут через wait


пример 
```
java -jar downloader_first_java.jar -f test_list.txt -l 850000 -n 4 -o test_result
Params:
		.Threads_count   : 4
		.speed_limit_kbs : 850
		.task_list_fname : test_list.txt
		.results_dir     : test_result\
```

```
Load task list done
```

```
T0		T1		T2		T3			Speed
200240	200240	200240	140168		740147
320384	340408	322641	719810		961843
320384	340408	322641	1568706		849408
320384	340408	322641	2418626		849920
320384	340408	322641	3269058		850432
320384	340408	322641	4119490		849920
320384	340408	322641	4969410		850432
320384	340408	322641	5819842		849920
320384	340408	322641	6670786		850093
320384	340408	322641	7519682		849408
320384	340408	322641	8369602		849920
320384	340408	322641	9220034		849920
320384	340408	322641	10070466		850432
320384	340408	322641	10920386		849920
320384	340408	322641	11221928		841376
ALL DONE
```

```
Statistics:
files copied     : 8
files downloaded : 65
files failed     : 0
files ignored    : 0
received total   : 12 205 361 bytes
work time        : 14.373 sec
Download speed   : 849 186 bytes/sec
```

```
Process finished with exit code 0
```